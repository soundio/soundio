<!DOCTYPE html>
<!-- Literal template "/Users/stephband/Sites/cruncher/editor.html.literal" -->

<html lang="en">
<head>
    <title>Test</title>

    <meta charset="utf-8" />
    <meta name="author" content="Cruncher" />
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width" />

    <script title="load">
        window.DEBUG = true;
        document.documentElement.className += ' js loading';
        // window.addEventListener('DOMContentLoaded', () => document.documentElement.classList.remove('content-loading'));
        // Wait for other load handlers to run first - Bolt does a few things on
        // load (eg. targetable scrolls) and we want them to run before the loading
        // class is removed
        window.addEventListener('load', () => window.requestAnimationFrame(() => document.documentElement.classList.remove('loading')));
    </script>

    <link rel="stylesheet" href="../../module.css" />
</head>

<body class="3x-grid grid">
    <h1>Test Soundstage</h1>
    <button type="button" value="" id="start">Start tests</button>
    <script type="module">
        import events     from '../../../dom/modules/events.js';
        import context    from '../context.js';
        import Soundstage from '../soundstage.js';

        const stage = Soundstage.from({
            objects: [{
                id: 1,
                type: 'tone',
                events: [
                    [0, 'sequence', 9, 0, 2]
                ],
                node: {
                    type: 'sine'
                }
            }, {
                id:   'output',
                type: 'output',
                node: {
                    channels: [0,1]
                }
            }],

            connectors: [
                [1, 'output']
            ],

            events: [
                // 180bpm
                [0, 'rate', 3]
            ],

            sequences: [{
                id: 9,
                events: [
                    // TODO: Should never be played - or should we play the tail end of it?
                    [-0.1, 'note', 80, 0, 0.2],
                    // Should be played
                    [0,   'note', 100, 0, 0.05],
                    [0.1, 'note', 200, 0, 0.2],
                    [0.2, 'param', 'gain', 0, 'exponential']
                ]
            }]
        });

        window.stage = stage;

        events('click', document.getElementById('start')).each((e) => {
            stage.start(context.currentTime + 1).stop(context.currentTime + 5);
        });
    </script>
</body>
</html>
